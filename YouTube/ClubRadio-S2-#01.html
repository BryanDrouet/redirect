<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Redirection YouTube</title>
    <link rel="stylesheet" href="../style.css" />
    <link rel="stylesheet" href="youtube.css" />
    <script>
      function getYouTubeUrl() {
        // Récupère l'URL depuis les paramètres GET ou utilise une URL par défaut
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('url') || 'https://youtube.com/live/5ID8Fp8f7oM';
      }

      function parseYouTubeUrl(url) {
        const patterns = {
          clip: /youtube\.com\/clip\/([^/?]+)/,
          post: /youtube\.com\/post\/([^/?]+)/,
          shorts: /youtube\.com\/shorts\/([^/?]+)/,
          video: /youtube\.com\/watch\?v=([^&]+)/,
          playlist: /youtube\.com\/playlist\?list=([^&]+)/,
          channel: /youtube\.com\/@([^/?]+)/
        };

        for (const [type, pattern] of Object.entries(patterns)) {
          const match = url.match(pattern);
          if (match) {
            return { type, id: match[1], originalUrl: url };
          }
        }

        return { type: 'unknown', id: null, originalUrl: url };
      }

      function openYouTube() {
        const userAgent = navigator.userAgent || navigator.vendor || window.opera;
        const targetUrl = getYouTubeUrl();
        const parsed = parseYouTubeUrl(targetUrl);
        
        let deeplink = null;
        let fallbackUrl = parsed.originalUrl;

        // Génère le deeplink selon le type
        switch (parsed.type) {
          case 'video':
            deeplink = `vnd.youtube://watch?v=${parsed.id}`;
            break;
          case 'shorts':
            deeplink = `vnd.youtube://shorts/${parsed.id}`;
            break;
          case 'channel':
            deeplink = `vnd.youtube://user/${parsed.id}`;
            break;
          case 'playlist':
            deeplink = `vnd.youtube://playlist?list=${parsed.id}`;
            break;
          case 'clip':
          case 'post':
          default:
            // Pas de deeplink spécifique, utilise l'URL web
            deeplink = null;
            break;
        }

        if (/android/i.test(userAgent) && deeplink) {
          // Android avec deeplink
          window.location = 
            `intent://www.youtube.com#Intent;scheme=https;package=com.google.android.youtube;` +
            `S.browser_fallback_url=${encodeURIComponent(fallbackUrl)};end`;
          // Fallback après 3 secondes
          setTimeout(() => {
            window.location = fallbackUrl;
          }, 3000);
        } else if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream && deeplink) {
          // iOS avec deeplink
          window.location = deeplink;
          // Fallback après 2 secondes
          setTimeout(() => {
            window.location = fallbackUrl;
          }, 2000);
        } else {
          // Desktop ou pas de deeplink - utilise l'URL web
          window.location = fallbackUrl;
        }
      }

      window.onload = function () {
        let countdown = 0;
        const timer = setInterval(() => {
          if (countdown > 0) {
            countdown--;
          } else {
            clearInterval(timer);
            openYouTube();
          }
        }, 1000);
      };
    </script>
  </head>
  <body>
    <div class="loader-container">
      <div class="logo-circle">
        <img
          src="https://www.youtube.com/favicon.ico"
          alt="YouTube Logo"
        />
      </div>
      <h1>
        Connexion à YouTube dans quelques secondes...
      </h1>
      <p>
        Si rien ne se passe,
        <a href="#" onclick="openYouTube(); return false;" class="link">clique ici</a>.
      </p>
      <div class="loader"></div>
    </div>
  </body>
</html>
