<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Redirection Twitch SunekitTTV</title>
    <link rel="stylesheet" href="../style.css" />
    <link rel="stylesheet" href="twitch.css" />
    <script>
      const redirectEnabled = true;
      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
      const twitchUser = "SunekitTTV";
      const twitchUrl = `https://www.twitch.tv/${twitchUser}`;

      function openTwitch() {
        if (!redirectEnabled) {
          document.getElementById("main-title").textContent = "Redirection désactivée !";
          document.getElementById("main-desc").innerHTML = `
            Redirection automatique désactivée sur ce lien.<br>
            <a href="https://www.twitch.tv/SunekitTTV" class="link">Cliquer ici pour accéder manuellement.</a>
          `;
          document.getElementById("main-desc").style.marginBottom = "0";
          document.querySelector(".loader").style.display = "none";
          return;
        }

        if (/android/i.test(userAgent)) {
          window.location = 
            `intent://user/${twitchUser}#Intent;scheme=twitch;package=tv.twitch.android.viewer;` +
            `S.browser_fallback_url=${encodeURIComponent(twitchUrl)};end`;

          setTimeout(() => {
            window.location = twitchUrl;
          }, 3000);
        } else if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
          window.location = twitchUrl;
        } else {
          window.location = twitchUrl;
        }
      }

      window.onload = function () {
        let countdown = 0;
        const counterElement = document.getElementById("countdown");
        document.getElementById("manual-link").href = twitchUrl;

        if (!redirectEnabled) {
          document.getElementById("main-title").textContent = "Redirection désactivée !";
          document.getElementById("main-desc").innerHTML =
            `Redirection automatique désactivée sur ce lien.<br>
            <a id="manual-link" href="${twitchUrl}" class="link">Cliquer ici pour accéder manuellement.</a>`;
          return;
        }

        const timer = setInterval(() => {
          if (countdown > 0) {
            counterElement.textContent = countdown;
            countdown--;
          } else {
            clearInterval(timer);
            openTwitch();
          }
        }, 1000);
      };
    </script>
  </head>
  <body>
    <div class="loader-container">
      <div class="logo-circle">
        <img
          src="../assets/logoTwitch.png"
          alt="Twitch Logo"
        />
      </div>
      <h1 id="main-title">
        Connexion à Twitch dans quelques secondes...
      </h1>
      <p id="main-desc">
        Si rien ne se passe,
        <a id="manual-link" href="#" class="link">clique ici</a>.
      </p>
      <div class="loader"></div>
    </div>
  </body>
</html>
